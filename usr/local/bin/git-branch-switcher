#!/bin/bash

# Ensure we're in a git repository
if ! git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
  echo "Not inside a git repository."
  exit 1
fi

# Get list of stashes
stash=$(git stash list | fzf --prompt="Select stash: ")

# Exit if no stash selected
[ -z "$stash" ] && echo "No stash selected." && exit 1

# Extract the stash reference (e.g., stash@{0})
stash_ref=$(echo "$stash" | awk -F: '{print $1}')

# Ask whether to apply or pop
action=$(printf "apply\npop" | fzf --prompt="Apply or pop stash: ")

[ -z "$action" ] && echo "No action selected." && exit 1

# Perform the action
git stash "$action" "$stash_ref"

